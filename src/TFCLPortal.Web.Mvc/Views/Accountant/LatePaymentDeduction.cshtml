@model List<TFCLPortal.Transactions.Dto.TransactionListDto>

@{
    Layout = "~/Views/Shared/_NewLayout.cshtml";
}
@*<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />*@
<style>
    .pageloader {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 9999;
        background: url('/Theame/images/loader.gif') 50% 50% no-repeat rgb(249, 249, 249);
        opacity: .8;
    }
</style>
<main class='main-content bgc-grey-100' style="padding-top:50px">
    <div class="pageloader d-none"></div>
    <div class="row page-title">
        <div class="col-md-6 text-left">
            <h4 class="page-title-text">
                Late Payment Deduction
            </h4>
            <h6 class="page-title-breadcrumbs">
                <a href="~/Dashboard/Dashboard">Home</a> > Accountant Operations > Loan Recovery > Late Payment Deduction
            </h6>
        </div>
        <div class="col-md-6 text-right">
            <a href="~/Dashboard/Dashboard" class="btn btn-sm btn-outline-success bg1 eft-1" title="Back"><i class="fa fa-angle-double-left"></i> Back To Home </a>
            <a class="btn btn-sm btn-outline-success bg1 eft-1" title="Client Schedule" href="/Accountant/ViewSchedule?ApplicationId=@ViewBag.ApplicationId"><i class="fa fa-calendar"></i> View Schedule</a>
        </div>
    </div>
    <div class="card p-10 mB-20">
        <div class="bgc-white bd bdrs-3 p-20 mB-20">
            @*<form asp-action="CreateLatePaymentDeduction" method="post">*@
                <div class="row">
                    <input type="hidden" id="ApplicationId" value="@ViewBag.Applicationid" />

                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Client ID</label>
                            <input type="text" value="@ViewBag.ClientId" readonly="readonly" class="form-control" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Applicant Name</label>
                            <input type="text" value="@ViewBag.ClientName" readonly="readonly" class="form-control text-uppercase" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Account Balance</label>
                            <input type="number" readonly="readonly" value="@ViewBag.Payment" class="form-control" />
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Late Days</label>
                            <input type="number" id="lateDays"  class="form-control" />
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Late Days Punishment</label>
                            <input type="number" id="lateDaysCalculate" readonly="readonly" class="form-control" />
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label>FED on Late Payment</label>
                            <input type="number" id="FEDonLPC" readonly="readonly" class="form-control" />
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Account Balance After Deduction</label>
                            <input type="number" id="updateAccBalance" readonly="readonly" class="form-control" />
                        </div>
                    </div>


                </div>
                    <div class="col-md-12 text-right" id="submitBtnDiv">
                    <button type="submit" class="btn btn-outline-danger" id="uploadBtn"><i class="fa fa-upload"></i> Generate Entry</button>
                    </div>
                    <div class="col-md-12 text-right text-danger">
                        <p id="responseText" class="text-right">@ViewBag.ErrorText</p>
                    </div>
            @*</form>*@
        </div>
    </div>
</main>
<script src="https://code.jquery.com/jquery-3.5.1.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" crossorigin="anonymous"></script>
<script src="~/vendor/numwords/index.js" crossorigin="anonymous"></script>

<script>


        function numberWithCommas(x) {
            x = Math.round(x);
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

    $("#uploadBtn").click(function (event) {

        var ApplicationId = '@ViewBag.Applicationid';
        var remainBalance = Number($('#updateAccBalance').val());
        var accBalance = ('@ViewBag.Payment');
        var LDays = $('#lateDays').val();
        var LDaysAmount = 100;
        var totalPunishment = Number(LDaysAmount * LDays);
        var fed = (totalPunishment * 0.16);
        var newtoalPunishment = (totalPunishment + fed);
        
        if (accBalance <= 0 || remainBalance < 0 ) {
            event.preventDefault();
        
            swal("Please deposit before deduction", {
                icon: "error",
                title: "Low Balance",
            })
                .then((value) => {
                    if (value == null || value == "") {
                        swal("Account Balance is Zero", {
                            icon: "error",
                        });
                    }
                    else {
                    }
                });
        }

        if (LDays == 0 || LDays == null) {
            event.preventDefault();
            swal("Please enter Late Days", {
                icon: "error",
                title: "Missing Late Days",
            })
                .then((value) => {
                    if (value == null || value == "") {
                        swal("Late Days are Zero", {
                            icon: "error",
                        });
                    }
                    else {
                    }
                });
        }
 
        //for post using ajax
        $(".pageloader").toggleClass("d-none");

        $.ajax({
            type: 'POST',
            datatype: "json",
            contenttype: 'application/json; charset=utf-8',
            url: '@Url.Content("~/Accountant/SaveLatePaymentDeduction")',
            data: {

                ApplicationId: Number(ApplicationId),
                LDays: Number(LDays),
                newtoalPunishment: Number(newtoalPunishment),
                remainBalance: Number(remainBalance),
                accBalance: Number(accBalance)
            },
 
            success: function (response) {
                $(".pageloader").toggleClass("d-none");
               // var returnData = data.result;
                abp.notify.success("Success");
                console.log(response);
                window.location.reload();

            },
            error: function (error) {
                
                console.log(error);
                $(".pageloader").toggleClass("d-none");
            }
        });

    });


    $('#lateDays').on('input', function () {
        var LDaysAmount = 100;
        var LDays = $('#lateDays').val();
        var totalPunishment = Number(LDaysAmount * LDays);
        var accBalance = '@ViewBag.Payment';
        var newAccBalance = 0;
        var fed = 0;

        newAccBalance = (accBalance - totalPunishment);
        fed = Number(totalPunishment * 0.16);
        newAccBalance = Number(newAccBalance - fed);
      
        $('#lateDaysCalculate').val(totalPunishment);
        $('#updateAccBalance').val(newAccBalance.toPrecision(6));
        $('#FEDonLPC').val(fed.toPrecision(6));
    });



</script>