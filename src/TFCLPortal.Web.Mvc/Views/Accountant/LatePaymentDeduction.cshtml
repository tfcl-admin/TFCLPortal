@model List<TFCLPortal.Transactions.Dto.TransactionListDto>

@{
    Layout = "~/Views/Shared/_NewLayout.cshtml";
}

<main class='main-content bgc-grey-100' style="padding-top:50px">
    <div class="row page-title">
        <div class="col-md-6 text-left">
            <h4 class="page-title-text">
                Late Payment Deduction
            </h4>
            <h6 class="page-title-breadcrumbs">
                <a href="~/Dashboard/Dashboard">Home</a> > Accountant Operations > Loan Recovery > Late Payment Deduction
            </h6>
        </div>
        <div class="col-md-6 text-right">
            <a href="~/Dashboard/Dashboard" class="btn btn-sm btn-outline-success bg1 eft-1" title="Back"><i class="fa fa-angle-double-left"></i> Back To Home </a>
            <a class="btn btn-sm btn-outline-success bg1 eft-1" title="Client Schedule" href="/Accountant/ViewSchedule?ApplicationId=@ViewBag.ApplicationId"><i class="fa fa-calendar"></i> View Schedule</a>
        </div>
    </div>
    <div class="card p-10 mB-20">
        <div class="bgc-white bd bdrs-3 p-20 mB-20">
            <form asp-action="CreateLatePaymentDeduction" method="post">
                <div class="row">
                    <input type="hidden" id="ApplicationId" value="@ViewBag.Applicationid" />

                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Client ID</label>
                            <input type="text" value="@ViewBag.ClientId" readonly="readonly" class="form-control" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Applicant Name</label>
                            <input type="text" value="@ViewBag.ClientName" readonly="readonly" class="form-control text-uppercase" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Account Balance</label>
                            <input type="number" readonly="readonly" value="@ViewBag.Payment" class="form-control" />
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Late Days</label>
                            <input type="number" id="lateDays"  class="form-control" />
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Late Days Punishment</label>
                            <input type="number" id="lateDaysCalculate" readonly="readonly" class="form-control" />
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label>FED on Late Payment</label>
                            <input type="number" id="FEDonLPC" readonly="readonly" class="form-control" />
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Account Balance After Deduction</label>
                            <input type="number" id="updateAccBalance" readonly="readonly" class="form-control" />
                        </div>
                    </div>


                </div>
                    <div class="col-md-12 text-right" id="submitBtnDiv">
                    <button type="submit" class="btn btn-outline-danger" id="uploadBtn"><i class="fa fa-upload"></i> Generate Entry</button>
                    </div>
                    <div class="col-md-12 text-right text-danger">
                        <p id="responseText" class="text-right">@ViewBag.ErrorText</p>
                    </div>
            </form>
        </div>
    </div>
</main>
<script src="https://code.jquery.com/jquery-3.5.1.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" crossorigin="anonymous"></script>
<script src="~/vendor/numwords/index.js" crossorigin="anonymous"></script>

<script>


        function numberWithCommas(x) {
            x = Math.round(x);
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

    $("#uploadBtn").click(function (event) {

        var remainBalance = Number($('#updateAccBalance').val());
        var  accBalance = Number('@ViewBag.Payment');
        alert(remainBalance);
        if (remainBalance > accBalance ) {
            event.preventDefault();
            swal("Please deposit before deduction", {
                icon: "warning",
                title: "Low Balance",
            })
                .then((value) => {
                    if (value == null || value == "") {
                        swal("Schedule Type Required!", {
                            icon: "warning",
                        });
                    }
                    else {
                    }
                });
        }
    });


    $('#lateDays').on('input', function () {
        var LDaysAmount = 100;
        var LDays = $('#lateDays').val();
        var totalPunishment = Number(LDaysAmount * LDays);
        var accBalance = '@ViewBag.Payment';
        var newAccBalance = 0;
        var fed = 0;

        newAccBalance = (accBalance - totalPunishment);
        fed = Number(totalPunishment * 0.16);
        newAccBalance = Number(newAccBalance - fed);
      
        $('#lateDaysCalculate').val(totalPunishment);
        $('#updateAccBalance').val(newAccBalance.toPrecision(6));
        $('#FEDonLPC').val(fed.toPrecision(6));
    });



</script>