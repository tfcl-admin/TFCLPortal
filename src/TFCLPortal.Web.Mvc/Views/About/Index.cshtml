@using TFCLPortal.Web.Startup
@model TFCLPortal.Web.Models.UploadFiles.FileUploadModel

@{
    int index = 1;
}
@{
    Random rnd = new Random();
}

@{
    ViewBag.CurrentPageName = PageNames.About; // The menu item will be active for this page.
    Layout = null;
}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

<style>
    .text-red {
        color: red;
    }

    .text-green {
        color: green;
    }

    .progress-bar {
        background-color: #20a756;
    }

    .blink_me {
        animation: blinker 1s linear infinite;
        color: blue;
    }

    @@keyframes blinker {
        50% {
            opacity: 0;
        }
    }
</style>
<div class="tab_content" style="padding: 3px 4px">
    <div class="row">
        @* <div class="col-md-2">
            </div>*@
        <div class="col-md-12">

            <!--<form action="/About/UploadFile" method="post" enctype="multipart/form-data">-->

            <form class="md-form" asp-controller="About" asp-action="UploadFileToServer" method="POST" enctype="multipart/form-data">

                <div class="card">
                    <div class="card-body">
                        @*<h5 class="card-title text-center">Submit File for Application ID : @ViewBag.Appid</h5>*@
                        <input type="hidden" value="@ViewBag.Appid" id="ApplicationId" name="ApplicationId" />
                        <input type="hidden" value="@ViewBag.UploadedBy" id="UploadedBy" name="UploadedBy" />
                        <p class="text-center @ViewBag.MsgCSS text-capitalize">@ViewBag.Msg</p>
                        <div class="row">
                            <div class="col-md-4  p-2">
                                <img src="~/images/icons/no-img.png" id="imagePreview" />
                            </div>
                            <div class="col-md-8">
                                <div class="card-text">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label for=""><strong>Document Type : </strong></label>
                                            <select id="FileTypeId" name="FileTypeId" class="form-control">
                                                @foreach (var item in Model.fileTypes)
                                                {
                                                    <option value="@item.Id">@(item.Category+" : "+item.Title)</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="col-md-12 pt-3">
                                            <label for="file" id="chooseFileText"><strong>Choose File : </strong></label>
                                            <input type="file" id="UploadedFile" name="UploadedFile" onchange="readURL(this);" />
                                        </div>
                                        <div class="col-md-12">
                                            <label for="" id="nameText"><strong>Select Name : </strong></label>
                                            <select id="ddrName" name="ddrName" class="form-control">
                                                @foreach (var item in Model.GuarantorCoApplicants)
                                                {
                                                    <option value="@item.Id">@item.Name</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="col-md-12 pt-3 pb-3">
                                            <label for="file"><strong>Description : </strong></label>
                                            <input type="text" id="Description" name="Description" class="form-control" />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-12 text-right">
                                <button id="submitbtn" class="card-link btn btn-outline-success" type="submit" style="width:100%">Upload</button>
                                <div id="progress" class="progress d-none">
                                    <div class="progress-bar progress-bar-striped bg-success" role="progressbar"  aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                 <div id="progressWait" class="d-none text-center">
                                     <p class="blink_me">Please Wait...</p>
                                </div>
                            </div>

                            <div class="col-md-2 text-right mt-5">
                                <a class="card-link btn btn-outline-warning" style="width:100%" onClick="window.location='/About/ViewFilesAll?ApplicationId=@Model.ApplicationId&&OnTab=1'"> <i class="fa fa-files-o"></i> Docs</a>
                                @*<a class="card-link btn btn-outline-warning" style="width:100%" onClick="window.location='/About/ViewFiles?ApplicationId=@Model.ApplicationId'"> <i class="fa fa-files-o"></i> Docs</a>*@
                            </div>
                            <div class="col-md-8 text-center mt-5">
                                @ViewBag.footerstring
                            </div>
                            <div class="col-md-2 text-right mt-5">
                                <a class="card-link btn btn-outline-success" style="width:100%" onClick="window.location.reload();"> <i class="fa fa-refresh"></i> Reload</a>
                            </div>

                        </div>
                    </div>
                </div>
            </form>



        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
             var extension = input.files[0].type;
            reader.onload = function (e) {
             extension=extension.replace(/(.*)\//g, '');
                 console.log(extension);

             if(extension.includes('sheet'))
             {
                $('#imagePreview').attr('src', '../../images/excel.png').css('width', '100%');
             }
             else if(extension.includes('pdf'))
             {
                $('#imagePreview').attr('src', '../../images/pdf.png').css('width', '100%');
             }
             else{
                $('#imagePreview').attr('src', e.target.result).css('width', '100%');
             }
            };

            reader.readAsDataURL(input.files[0]);
             $('#chooseFileText').removeClass("blink_me");


        }
    }

    var progressval=0;
    $('#submitbtn').click(function(){
        $('#submitbtn').addClass('d-none');
        $('#progress').removeClass('d-none');

        setInterval(updateProgress,100);

        //alert('test')
    });
    //updateProgress();
    function updateProgress(){
        //alert(progressval);
        progressval+=1;
         $('.progress-bar').css("width", progressval+"%");

         if(progressval>=100)
         {
             $('#progressWait').removeClass('d-none');
         }
    }

    $(document).ready(function () {

        $('#FileTypeId').change(function () {
            var optionSelected = $(this).find("option:selected");
            var textSelected = optionSelected.text();
            if (textSelected.includes('Guarantor')) {
                $('#nameText').removeClass("blink_me");
                $('#ddrName').attr("disabled", false);
                $('#nameText').addClass("blink_me");
            }
            else if (textSelected.includes('Co-Applicant')) {
                $('#nameText').removeClass("blink_me");
                $('#nameText').addClass("blink_me");
                $('#ddrName').attr("disabled", false);
            }
            else {
                $('#ddrName').attr("disabled", true);
                $('#ddrName').val(0);
                $('#nameText').removeClass("blink_me");
            }


                $('#chooseFileText').removeClass("blink_me");
                $('#chooseFileText').addClass("blink_me");


        });

        $('#ddrName').attr("disabled", true);
        $('#ddrName').val(0);

    });

</script>
